---
description: 微信小游戏开发指南
alwaysApply: true
enabled: true
updatedAt: {{UPDATE_TIME}}
provider: no.js
---

## 代码设计原则

### 可维护性是第一优先级
1. DRY
保持一致性，避免冗余
有能复用的功能则抽象出公共代码
同类的变量/逻辑，尽量引用/复用，非必要不要冗余多份

2. KISS
保持简单，避免复杂
能简单同步实现的，不要用异步(比如单生产者单订阅者不要用事件订阅机制解耦)

3. OOP 
组合优先于继承，UI相关可以考虑继承
封装，基于契约编程：操作和数据需要封闭在类中，避免全局变量，避免跨类直接访问数据
高内聚低耦合：一个类/模块尽量只做一件事，但也不用过度拆分

### 可维护性的基础上，尽早考虑性能优化
1. 尽可能用当前游戏引擎、第三方知名库中已有的模块组合完成功能实现，避免重复造轮子
2. 内存占用需要尽可能小，不用的内存及时释放
3. 代码需要尽量保证高效执行(复杂度低的算法)，少执行或者不执行(通过缓存计算等手段)，特别是帧循环中或者反复被执行的代码

## 项目基本规范

### 文档驱动开发
1. 所有核心模块的实现逻辑都要和设计文档保持一致(docs)，有变动时同步修改设计文档
2. 设计文档规范：尽量保持简洁，注重描述要做什么。如何实现的细节除非特别关键，否则没必要存在（比如大段的代码示例）
3. 玩法相关的核心算法（比如寻路）相关代码的变更，应该添加详尽(覆盖率90%以上)的单元测试(普通UI交互无需考虑，除非用户要求)
   - 测试用例统一放到tests目录下
   - 只运行这次变更相关的测试用例，确保其测试通过
   - 运行单元测试命令无需询问用户，直接执行

### 架构规范
- 场景驱动：所有逻辑围绕场景组织，每个场景按独立目录组织
- 分层清晰：Scene → Domain → ECS/GameObject → Rendering
- 场景 ≤ 2000 行 / GameObject ≤ 500 行
- Component 纯数据 / 领域不依赖 UI / 无循环依赖

### 命名规范
- 类名：大驼峰 `PlayerController`
- 方法/变量：小驼峰 `updateScore()`
- 常量：大写下划线 `MAX_HEALTH`

## 需求处理流程
1. 必须总是遵守no.js规范：../no.js/docs/index.md为规范的入口文件，其他规范按需引入
2. 必须总是遵守no.js规范的宪章：../no.js/docs/charter.md。新功能都要归属到场景下
3. 如果项目使用Pixi.js，必须参考技术最佳实践：docs/tech/目录下的技术文档
4. 禁止自动提交git：提交git之前需要取得用户的明确同意，否则只能给出相关命令
5. 完成用户需求后，不要做过多的总结，特别是不要额外写设计文档(docs)之外的其他文档
6. 每次完成用户需求后若涉及代码变更则运行npm run build，并展示构建版本号和构建时间